@startuml
actor Actor
participant ":Quotely" as Quotely
participant ":Storage" as Storage
participant ":JsonSerializer" as Serializer
participant "appData:ApplicationData" as AppData
participant ":Parser" as Parser
participant "cmd:Command" as Command
database ":data/quotely.json" as DB

skinparam sequenceArrowThickness 2
skinparam roundcorner 5
skinparam padding 2

group App Startup (Loading Data)
    Actor -> Quotely ++: Starts Application
    Quotely -> Quotely: new Quotely()

    Quotely -> Quotely ++ #LightBlue: loadDataFromFile()
    Quotely -> Storage ++ #Pink: loadData()
    Storage -> DB: Read File
    Storage --> Quotely: jsonString
    deactivate Storage

    Quotely -> Serializer ++ #FFBBBB: deserialize(jsonString)
    Serializer --> Quotely --: appData:ApplicationData
    deactivate Serializer

    Quotely -> AppData ++: getQuoteList()
    AppData --> Quotely: quoteList
    deactivate AppData

    Quotely -> AppData ++: getCompanyName()
    AppData --> Quotely: companyName
    deactivate AppData

    deactivate Quotely

    return
end

group Command Execution (Saving Data)
    Actor -> Quotely ++ #Gold: register c/New Company

    ' 1. Parse Command
    Quotely -> Parser ++ #DarkSalmon: parse(...)
    Parser -> Command **: new RegisterCommand(...)
    activate Command #Green
    Parser --> Quotely: cmd:RegisterCommand
    deactivate Parser

    ' 2. Execute Command
    Quotely -> Command ++ #Green: execute(..., companyName, ...)
    ' (Command modifies the companyName object in memory)
    Command --> Quotely
    deactivate Command

    ' 3. Save Data
    Quotely -> Quotely ++ #LightBlue: saveDataToFile()

    Quotely -> AppData **: new ApplicationData(quoteList, companyName)
    activate AppData

    Quotely -> Serializer ++ #FFBBBB: serialize(appData)
    Serializer --> Quotely: jsonString
    deactivate Serializer
    deactivate AppData

    Quotely -> Storage ++ #Pink: saveData(jsonString)
    Storage -> DB: Write File
    Storage --> Quotely
    deactivate Storage

    deactivate Quotely

    return
end
@enduml